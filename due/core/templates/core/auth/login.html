{% extends "core/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Đăng nhập - DUE Network{% endblock %}

{% block content %} {# Hoặc một block khác phù hợp trong base.html của bạn #}
<style>
    /* CSS cho trang login có thể đặt trực tiếp ở đây hoặc trong file static chính */
    /* Bạn có thể copy nội dung từ auth_style.css vào đây nếu muốn */
    body, html {
        /* height: 100%; */ /* Có thể không cần nếu base.html đã xử lý */
        /* margin: 0; */
        font-family: 'Inter', sans-serif;
    }

    .auth-main-content { /* Class này sẽ bọc nội dung login */
        display: flex;
        min-height: calc(100vh - 112px); /* Giả sử navbar + toolbar_height là 112px */
        /* Điều chỉnh chiều cao này cho phù hợp với layout base.html của bạn */
        /* nếu base.html có navbar/toolbar cố định */
        background-color: #eef2f7; /* Màu nền nhẹ cho khu vực auth */
        padding-top: 2rem; /* Khoảng cách với top nếu có navbar */
    }

    .auth-container {
        display: flex;
        width: 100%;
        align-items: stretch;
        margin: auto; /* Căn giữa nếu auth-main-content là flex */
    }

    .auth-card {
        width: 100%;
        max-width: 480px;
        margin: 2rem auto; /* Tự động căn giữa và tạo khoảng cách */
        padding: 30px 40px;
        background-color: #ffffff;
        border-radius: 0.75rem;
        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    }

    .auth-background-text {
        flex-grow: 1;
        background-color: #f0f4f8;
        color: #333;
        display: none; /* Mặc định ẩn nếu dùng chung base.html, trừ khi bạn muốn hiện */
        /* ... (các style khác cho auth-background-text) ... */
    }

    /* Responsive: nếu muốn phần text nền hiện ra trên màn hình lớn */
    @media (min-width: 992px) { /* lg breakpoint */
        .auth-main-content {
             padding-top: 0;
        }
        .auth-card {
            margin: 0; /* Reset margin khi layout 2 cột */
            border-radius: 0;
             box-shadow: 0 0 25px rgba(0,0,0,0.05);
        }
        .auth-background-text {
            display: flex; /* Hiện lại trên màn hình lớn */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }
         .auth-background-text h1 {
            font-size: 3.5rem;
            font-weight: bold;
            color: #0056b3;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }
        .auth-background-text p {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
        }
    }

    /* Input fields styling (nếu không dùng crispy hoặc muốn override) */
    .form-control {
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        border: 1px solid #ced4da;
    }
    .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .btn {
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
    }
    .input-group .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }
    .input-group .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
</style>

<div class="auth-main-content"> {# Bọc nội dung chính của trang login #}
    <div class="auth-container">
        <div class="auth-card">
            <div class="text-center mb-4">
                <img src="{% static 'core/images/due_network_logo_main.png' %}" alt="DUE Network Logo" style="max-width: 180px;">
                <h2 class="mt-3">Đăng nhập</h2>
                <p class="text-muted">Chào mừng bạn trở lại!</p>
            </div>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <form method="POST" action="{% url 'login' %}">
                {% csrf_token %}
                {{ form|crispy }}

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="rememberMe" name="remember">
                        <label class="form-check-label" for="rememberMe">Nhớ tài khoản</label>
                    </div>
                    <a href="{% url 'password_reset_request' %}" class="text-decoration-none small">Quên mật khẩu?</a>
                </div>

                <button type="submit" class="btn btn-primary w-100 mb-3">Đăng nhập</button>

                <div class="text-center">
                    <p class="text-muted mb-0">Chưa có tài khoản?</p>
                    <a href="{% url 'register' %}" class="btn btn-outline-primary w-100">Đăng ký</a>
                </div>
            </form>
        </div>
        <div class="auth-background-text">
            <h1>due network</h1>
            <p>Kết nối DUE-ers. Chia sẻ cơ hội.</p>
            <p>Mở rộng tương lai.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %} {# Ghi đè hoặc bổ sung block extra_scripts từ base.html #}
{{ block.super }} {# Gọi lại nội dung của block.super nếu base.html có script chung #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Logic cho toggle password
    const passwordInputId = '{{ form.password.id_for_label }}'; // Lấy ID động từ form
    const passwordInput = document.getElementById(passwordInputId);

    if (passwordInput) {
        // Tạo nút toggle
        const toggleButton = document.createElement('button');
        toggleButton.classList.add('btn', 'btn-outline-secondary');
        toggleButton.type = 'button';
        toggleButton.innerHTML = '<i class="far fa-eye"></i>';
        toggleButton.style.borderTopLeftRadius = '0';
        toggleButton.style.borderBottomLeftRadius = '0';


        // Bọc input và button trong input-group nếu chưa có (khó nếu crispy đã render)
        // Cách đơn giản hơn là đảm bảo form field password được render trong 1 input-group
        // Hoặc bạn có thể tìm input password và chèn nút vào sau nó (cần CSS để căn chỉnh)
        const inputGroup = passwordInput.closest('.input-group');
        if (inputGroup) { // Nếu crispy form render password trong input-group
             inputGroup.appendChild(toggleButton);
        } else { // Nếu không, chèn vào sau input và tự style
            passwordInput.parentNode.insertBefore(toggleButton, passwordInput.nextSibling);
            // Cần thêm CSS để input và button này hiển thị inline và đẹp
        }


        toggleButton.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            const icon = this.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        });
    }
});
</script>
{% endblock %}