{% load static %}
{% load humanize %}

<div class="card h-100 event-card shadow-sm" id="event-{{ event.id }}">
    <div class="card-img-top-container position-relative">
        {% if event.image %}
            <img src="{{ event.image.url }}" class="card-img-top" alt="{{ event.title }}">
        {% else %}
            <div class="d-flex align-items-center justify-content-center h-100 bg-light">
                <i class="fas fa-image fa-3x text-muted"></i>
            </div>
        {% endif %}
        {% if event.tags.all %}
            <div class="event-tags">
                {% for tag in event.tags.all|slice:":2" %}
                    <span class="badge bg-primary text-white shadow-sm">{{ tag.name }}</span>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    <div class="card-body d-flex flex-column">
        {# Link đến trang chi tiết sự kiện #}
        <a href="{% url 'event_detail' event.id %}" class="text-decoration-none">
            <h5 class="card-title mb-2">{{ event.title }}</h5>
        </a>
        <p class="card-text text-muted flex-grow-1">{{ event.content|truncatewords_html:20 }}</p>
        <small class="text-muted">
            Tạo bởi:
            <a href="{% if event.creator %}{% url 'profile' event.creator.username %}{% else %}#{% endif %}" class="text-decoration-none">
                @{{ event.creator.username|default:'N/A' }}
            </a>
            - {{ event.created_at|naturaltime }}
        </small>
    </div>
    <div class="card-footer bg-white d-flex justify-content-around py-1 border-top-0">
        <button class="btn btn-sm btn-link text-muted like-event-btn {% if event.is_liked_by_user %}text-danger{% endif %}"
                data-event-id="{{ event.id }}"
                title="Thích sự kiện này">
            <i class="fa-heart {% if event.is_liked_by_user %}fas text-danger{% else %}far{% endif %}"></i>
            <span class="like-count small">{{ event.likes.count|default:0 }}</span> {# Thêm default:0 #}
        </button>
        
        <button class="btn btn-sm btn-link text-muted share-event-btn"
                data-event-id="{{ event.id }}"
                title="Chia sẻ sự kiện">
            <i class="fas fa-share"></i>
        </button>
    </div>
</div>